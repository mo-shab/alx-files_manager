# Tasks To Complete

+ [x] 0. **Redis utils**
  + Inside the folder [`utils`](utils), create a file [`redis.js`](utils/redis.js) that contains the class `RedisClient`.
  + `RedisClient` should have:
    + The constructor that creates a client to Redis:
    + Any error of the redis client must be displayed in the console (you should use `on('error')` of the redis client).
    + A function `isAlive` that returns `true` when the connection to Redis is a success otherwise, `false`.
    + An asynchronous function `get` that takes a string key as argument and returns the Redis value stored for this key.
    + An asynchronous function `set` that takes a string key, a value and a duration in second as arguments to store it in Redis (with an expiration set by the duration argument).
    + An asynchronous function `del` that takes a string key as argument and remove the value in Redis for this key.
  + After the class definition, create and export an instance of `RedisClient` called `redisClient`.

+ [x] 1. **MongoDB utils**
  + Inside the folder [`utils`](utils), create a file [`db.js`](db.js) that contains the class `DBClient`.
  + `DBClient` should have:
    + The constructor that creates a client to MongoDB:
      + host: from the environment variable `DB_HOST` or default: `localhost`.
      + port: from the environment variable `DB_PORT` or default: `27017`.
      + database: from the environment variable `DB_DATABASE` or default: `files_manager`.
    + A function `isAlive` that returns `true` when the connection to MongoDB is a success otherwise, `false`.
    + An asynchronous function `nbUsers` that returns the number of documents in the collection `users`.
    + An asynchronous function `nbFiles` that returns the number of documents in the collection `files`.
  + After the class definition, create and export an instance of `DBClient` called `dbClient`.

+ [x] 2. **First API**
  + Inside [`server.js`](server.js), create the Express server:
    + It should listen on the port set by the environment variable `PORT` or by default 5000.
    + It should load all routes from the file [`routes/index.js`](routes/index.js).
  + Inside the folder [`routes`](routes), create a file [`index.js`](routes/index.js) that contains all endpoints of our API:
    + `GET /status` => `AppController.getStatus`.
    + `GET /stats` => `AppController.getStats`.
  + Inside the folder controllers, create a file AppController.js that contains the definition of the 2 endpoints:
    + `GET /status` should return if Redis is alive and if the DB is alive too by using the 2 utils created previously: `{ "redis": true, "db": true }` with a status code 200.
    + `GET /stats` should return the number of users and files in DB: `{ "users": 12, "files": 1231 }` with a status code 200.
      + `users` collection must be used for counting all users.
      + `files` collection must be used for counting all files.

+ [x] 3. **Create a new user**
  + Now that we have a simple API, it's time to add users to our database.
  + In the file [`routes/index.js`](routes/index.js), add a new endpoint:
    + `POST /users` => `UsersController.postNew`.
  + Inside [`controllers`](controllers), add a file [`UsersController.js`](UsersController.js) that contains the new endpoint:
    + `POST /users` should create a new user in DB:
      + To create a user, you must specify an `email` and a `password`.
      + If the `email` is missing, return an error `Missing email` with a status code 400.
      + If the `password` is missing, return an error `Missing password` with a status code 400.
      + If the `email` already exists in DB, return an error `Already exist` with a status code 400.
      + The error messages should be in a JSON object. For e.g.; `{"error":"Already exist"}`.
      + The `password` must be stored after being hashed in `SHA1`.
      + The endpoint is returning the new user with only the `email` and the `id` (auto generated by MongoDB) with a status code 201.
      + The new user must be saved in the collection `users`:
        + `email`: same as the value received.
        + `password`: `SHA1` value of the value received.